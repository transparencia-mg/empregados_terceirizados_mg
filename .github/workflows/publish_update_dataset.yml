name: Atualizar CKAN

on:
  push:
    paths:
      - data/**
      - datapackage/**

jobs:
  publish_ckan:
    runs-on: ubuntu-22.04

    steps:
      - uses: actions/checkout@v4

      - uses: actions/setup-python@v4
        with:
          python-version: "3.10"

      - name: Instalar dependÃªncias
        run: pip install requests

      - name: Publicar recursos no CKAN
        env:
          CKAN_HOST: https://www.dados.mg.gov.br
          CKAN_KEY: ${{ secrets.CKAN_KEY }}
          DATASET: empregados-terceirizados-mg
          GITHUB_REPO: transparencia-mg/empregados_terceirizados_mg
          GITHUB_BRANCH: main
        run: python scripts/publish_resources.py
